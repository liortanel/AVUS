@{
    ViewData["Title"] = "Turnos Médicos";
    var turnos = ViewBag.Turnos as IEnumerable<AVUS.Models.Turno>;
    var ahora = (DateTime)ViewBag.Ahora;
}

<div class="tutoriales-header">
    <h1><i class="fas fa-user-md"></i> Turnos Médicos</h1>
    <p>Agregá y consultá tus turnos con especialistas</p>
    <div style="margin-top:1rem;">
        <a class="btn-back" href="@Url.Action("Salud", "Home")" style="max-width: 200px; margin: 0 auto; display:block;">Volver a Salud</a>
    </div>
</div>

<div class="tutoriales-grid" style="margin-top: 2rem;">
    <div class="tutorial-card">
        <h3>Agregar turno</h3>
        @if (TempData["TurnoError"] != null)
        {
            <div class="card-footer" style="color:#c0392b">@TempData["TurnoError"]</div>
        }
        @if (TempData["TurnoOk"] != null)
        {
            <div class="card-footer" style="color:#27ae60">@TempData["TurnoOk"]</div>
        }
        <form method="post" action="@Url.Action("CrearTurno", "Home")" class="row g-3">
            <div class="col-12 col-md-3">
                <label class="form-label">Especialidad</label>
                <input name="especialidad" class="form-control" />
            </div>
            <div class="col-12 col-md-3">
                <label class="form-label">Dr/ Dra</label>
                <input name="medico" class="form-control" />
            </div>
            <div class="col-12 col-md-2">
                <label class="form-label">Día</label>
                <input name="dia" type="date" class="form-control" />
            </div>
            <div class="col-12 col-md-2">
                <label class="form-label">Hora</label>
                <input name="hora" type="time" class="form-control" />
            </div>
            <div class="col-12 col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Agregar</button>
            </div>
        </form>
    </div>

    <div class="tutorial-card">
        <h3>Próximos turnos</h3>
        @if (turnos == null || !turnos.Any())
        {
            <div class="card-footer">No hay turnos cargados.</div>
        }
        else
        {
            <div class="list-group">
                @foreach (var t in turnos)
                {
                    var fecha = (t.dia.HasValue ? t.dia.Value.Date : DateTime.MaxValue.Date) + (t.hora ?? TimeSpan.Zero);
                    var esProximo = fecha >= ahora;
                    <div class="list-group-item d-flex justify-content-between align-items-center @(esProximo ? "list-group-item-primary" : "")">
                        <div>
                            <div class="fw-bold">@t.especialidad</div>
                            <div class="text-muted">Dr/a. @t.medico</div>
                        </div>
                        <div class="text-nowrap text-end">
                            @fecha.ToString("dd/MM/yyyy HH:mm")
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>


